<!doctype html>
<html>
<head>
    <title>Little app of calm</title>
    <meta charset="utf-8">
     <link rel="stylesheet" href="/css/bulma/bulma.min.css"> 
     <link rel="stylesheet" href="/css/custom_stylesheet.css"> 
    <script type="text/javascript"
        src="/js/brython/brython.js">
    </script>
    <script src="/js/brython/brython_stdlib.js"> </script>
    <script src="https://unpkg.com/htmx.org@1.2.0"></script>
</head>

<body onload="brython()">
    
    {% if context.second_attempt %}
    found: <a href="/api_submissions/{{ context.group_nr }}/{{ context.second_attempt[1] }}/{{ context.index.n }}/{{ context.second_attempt[3] }}">Egenretting</a>
    {% endif %}
<!-- Top section --> 
  <div class="container">
      <div class="notification is-light">
  <nav class="level">
      <div class="level-left">
            Student: <input class="input" type="text" type="text" value="{{ context.sis_user_id }}" id="studentcode" readonly>
        <button class="button is-primary is-light" onclick="copyStudentcode()">Copy to clipboard!</button>
        <span id="info-success-copy-code" class="tag is-success is-light invisible">Copied to clipboard!</span>
      </div>

      <a href="/api_submissions/{{ context.group_nr }}/{{context.assignment_name}}/" class="button">{{ context.assignment_name }}</a>
      <a href="/api_submissions/{{ context.group_nr }}/" class="button">Group {{ context.group_nr}}</a>
      <div class="cycle-students">
          {% if context.index.prev %}
          <a href="/api_submissions/{{context.group_nr}}/{{context.assignment_name}}/{{context.index.n -1}}" class="button">&lt; Previous</a>
          {% endif %}
          {% if context.index.next %}
              <a href="/api_submissions/{{context.group_nr}}/{{context.assignment_name}}/{{context.index.n +1}}" class="button">Next &gt;</a>
          {% else %}
              <a href="#" class="button" >Finito!</a>
          {% endif %}
      </div>
      
  </nav>
  </div>
  </div>

{% if context %}
<div class="container">  
    <!-- Output box -->
    <div class="box">
      <div class="content">
        <nav class="level">
            <div class="level-left">
              Result:
            </div>
            <div class="level-right">
                <button class="button" onclick="clearUp()">Clear result</button>
            </div>
        </nav>
           <pre><code class="python" id="result-code-ran">Run the code, see the results here...</code></pre>
           <div id="running"></div>
      </div>
</div>

<!-- Modal for tasks -->

<div id="task-modal" class="modal">
  <div class="modal-background"></div>
  <div class="modal-card">
    <header class="modal-card-head">
        <p class="modal-card-title">Task description</p>
      <button id="close-modal" class="delete" aria-label="close"></button>
    </header>
    <section class="modal-card-body">
        {{ context.tasks }}
    </section>
    <footer class="modal-card-foot">
        <a href="/pdfs/{{ context.pdf }}" target="_blank">Open as PDF</a>
    </footer>
  </div>
</div>


<!-- Mid - buttons -->
<nav class="level">
  <div class="level-left">
    <button class="button is-primary is-light" onclick="copyStudentsubmission()">Copy submission to clipboard!</button>
    <span id="info-success-copy-submission" class="tag is-success is-light invisible">Copied to clipboard!</span>
  </div>
  <div class="level-item">
    <button id="task" class="button is-primary is-light" onclick="activateModal()">Task description</button>
  </div>

  <div class="level-right">
    <button class="button is-primary is-light" onclick="runCodeInPython()">Run code!</button>
  </div>
</nav>

<div class="level">
    <div class="level-left"></div>
        <div class="level-right">
            <form id="save_to_canvas" hx-post="/put-canv" hx-target="this" hx-swap="outerHTML">
            <div class="field is-grouped">
                <div class="select">
                  <select name="grade">
                    <option value="null">Ikke karaktersatt</option>
                    <option value="incomplete">Ikke godkjent</option>
                    <option value="complete">Godkjent</option>
                  </select>
                  <input type="hidden" name="comment" id="formcomment" />
                  <input type="hidden" name="user_id" value="{{ context.user_id }}" />
                  <input type="hidden" name="assignment_id" value="{{ context.assignment_id }}" />
                </div>
                <div class="control">
                    <button class="button is-primary is-light" onclick="getCommentFeedback()">Save to Canvas</button>
                  </div>
                </div>
            </form>
        </div>
</div>

<section class="section">
    <div class="container custom-ace-container">
        <div class="columns ">
            <div id="parent-to-ace" class="column is-three-fifths is-mobile">
                <code class="python" id="submissioncode">{{ context.code }}</code>
                {% else %}
                <h1>Could not find file</h1>
                {% endif %}
            </div>
            <div id="parent-to-ace" class="column is-mobile">
                <div id="feedback-field" form="save_to_canvas">Feedback to {{ studentcode }}:</div>
            </div>
        </div>
    </div>
</section>

<footer class="footer">
    <div class="content has-text-centered">
      <p>Hit <code>CTRL  ,</code> for editor settings <code>(macos: ⌘,)</code></p>
    <p>
      <strong>Little App of Calm</strong>  <a href="https://youtu.be/e1oO08T49s8">(not a book)</a>
    </p>
  </div>
</footer>

    <script>
        var assignment_name = "{{ context.assignment_name }}";
        var group_n = "{{ context.group_nr }}";
    </script>
<script src="/js/custom_base.js" type="text/javascript" charset="utf-8"></script>
<script src="/js/custom_py.py" type="text/python" charset="utf-8"></script>
<script id="customHandler" type="text/python">
     
from browser import document
from browser.local_storage import storage
# Mocking file read/write

class File:

  def __init__(self, name, mode):
      self.name = name
      self.mode = mode
      self.content = ''

  def __enter__(self):
      return self

  def __exit__(self, exc_type, exc_value, tb):
      pass

  def write(self, data):
      if self.mode == "w":
          self.content += data
          storage[self.name] = self.content
      else:
          raise IOError("read only")

  def read(self):
      if self.name in storage:
          return storage[self.name]
      raise IOError("file not found")

  def close(self):
      return

def mock_open(name, mode="r"):
    print("Mocked open")
    return File(name, mode)

open = mock_open

</script>


<script src="/js/ace/src-noconflict/ace.js" type="text/javascript" charset="utf-8"></script>
<script>
    var feedback = ace.edit("feedback-field");
    feedback.setTheme("ace/theme/github");
    feedback.setOptions({
        showLineNumbers: false,
        displayIndentGuides: false,
        highlightGutterLine: false,
        printMargin: false,
        showGutter: false,
        minLines: 50,
        wrap: true,
    });
    feedback.session.setMode("ace/mode/markdown");
    var editor = ace.edit("submissioncode");
    editor.setTheme("ace/theme/gruvbox");
    editor.session.setMode("ace/mode/python");
</script>
</body>
</html>

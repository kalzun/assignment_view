<!doctype html>
<html>
<head>
    <title>Small app of calm</title>
    <link rel="stylesheet"
      href="/js/highlight/styles/gruvbox-dark.css">
     <link rel="stylesheet" href="/css/bulma/bulma.min.css"> 
<style>

.invisible {
    visibility: hidden;
}

#info-success-copy-code #info-success-copy-submission {
  position: relative;
  display: inline-block;
}


  #result-code-ran {
      min-height: 50px;

}

        
</style>
<script src="/js/highlight/highlight.pack.js"></script>
<script src="/js/shortcuts.js"></script>
<script charset="UTF-8" src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.2/languages/python.min.js"></script>
 <script>hljs.initHighlightingOnLoad();</script>
<!-- and it's easy to individually load additional languages -->
   <!-- <link rel="stylesheet" href="/path/to/styles/default.css"> -->
    <!-- <script src="static/js/highlight/highlight.pack.js"></script> -->
    <!-- <script>hljs.initHighlightingOnLoad();</script> -->
    <script type="text/javascript"
        src="/js/brython/brython.js">
    </script>
    <script src="/js/brython/brython_stdlib.js">
    </script>
</head>

<body onload="brython()">

  <section class="section">
      <div class="container">
      <nav class="level">
          <div class="level-left">
                Student: <input class="input" type="text" type="text" value="{{filename}}" id="studentcode" readonly>
            <button class="button is-primary is-light" onclick="copyStudentcode()">Copy to clipboard!</button>
            <span id="info-success-copy-code" class="tag is-success is-light invisible">Copied to clipboard!</span>
          </div>
          <div class="level-item">
            <button class="button is-primary is-light" onclick="copyStudentsubmission()">Copy submission to clipboard!</button>
            <span id="info-success-copy-submission" class="tag is-success is-light invisible">Copied to clipboard!</span>
          </div>
          <div class="level-right">
            <button class="button is-primary is-light" onclick="runCodeInPython()">Run code!</button>
          </div>
      </nav>
      </div>
        {% if context %}
        <div class="container">  
        
    <!-- Output box -->

    <div class="box">
  <article class="media">
    <div class="media-content">
      <div class="content">
        <p>
        <nav class="level">
            <div class="level-left">
              Result:
            </div>
            <div class="level-left">
            <button class="button" onclick="clearUp()">Clear result</button>
            </div>
        </nav>
          <br>
               <pre><code class="python" id="result-code-ran">Run the code, see the results here...</code></pre>
               <div id="running"></div>
        </p>
      </div>
      <nav class="level is-mobile">
        <div class="level-left">
          <a class="level-item" aria-label="reply">
            <span class="icon is-small">
              <i class="fas fa-reply" aria-hidden="true"></i>
            </span>
          </a>
          <a class="level-item" aria-label="retweet">
            <span class="icon is-small">
              <i class="fas fa-retweet" aria-hidden="true"></i>
            </span>
          </a>
          <a class="level-item" aria-label="like">
            <span class="icon is-small">
              <i class="fas fa-heart" aria-hidden="true"></i>
            </span>
          </a>
        </div>
      </nav>
    </div>
  </article>
</div>

            <div>
               <pre><code class="python" id="submissioncode">{{ context }}
               </code></pre>
            </div>
        </div>
        {% else %}
          <h1>Could not find file</h1>
        {% endif %}

        </div>
  </section>

<footer class="footer">
  <div class="content has-text-centered">
    <p>
      <strong>A little app of calm</strong> by <a href="https://longrind.com">Erik And</a>. </p>

  </div>
</footer>

<script type="text/javascript">
    function createPythonCode() {
        const pythonScript = document.createElement("script");
        const parent = document.getElementById("running");
        pythonScript.type = "text/python";
        pythonScript.append(document.querySelector("#submissioncode").textContent);
        parent.appendChild(pythonScript);
    }
</script>

<script type="text/python">
from browser import document

class Redirect:
    def write(self, *args, output_id='result-code-ran', end='\n', sep=' '):
        document[output_id].textContent += sep.join(args) + end

redirect = Redirect()
import sys
sys.stdout = redirect
sys.stderr = redirect
#result = document["esult-code-ran"]
#result.textContent = 'Hiyea!'
</script>

    <script>

        function clearUp() {
            const result = document.getElementById("result-code-ran");
            const previousRun = document.getElementById("running");
            previousRun.textContent = '';
            result.textContent = '';
        }

        function runCodeInPython() {
            clearUp();
            createPythonCode();
            brython();
        }

        function copyStudentcode() {
          /* Get the text field */
          var copyText = document.getElementById("studentcode");

          /* Select the text field */
          copyText.select();
          copyText.setSelectionRange(0, 99999); /*For mobile devices*/

          /* Copy the text inside the text field */
          document.execCommand("copy");

          /* Alert the copied text */
          <!-- alert("Copied the text: " + copyText.value); -->
          
          toggleSuccessInfo("info-success-copy-code");
            
        }; 

        function copyStudentsubmission() {
          /* Get the text field */
          const el = document.createElement('textarea');
          el.value = document.getElementById("submissioncode").textContent;
          el.setAttribute('readonly', '');
          el.style.position = 'absolute';
          el.style.left = '-9999px';
          document.body.appendChild(el);
          el.select();
          document.execCommand('copy');
          document.body.removeChild(el);

          toggleSuccessInfo("info-success-copy-submission");
        } 

        function toggleSuccessInfo(elemid){
          document.getElementById(elemid).classList.toggle("invisible");
          let promise = new Promise(function(resolve, reject) {
              setTimeout(() => resolve("done"), 1000);
            });
          promise.then(
              () => {document.getElementById(elemid).classList.toggle("invisible");}
          ); 
            
        }

    
        shortcut.add("ctrl+y", copyStudentcode);
        shortcut.add("ctrl+Y", copyStudentsubmission);
    </script>

</body>
</html>
